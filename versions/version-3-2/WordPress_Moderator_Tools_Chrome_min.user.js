// ==UserScript==
// @name        WordPress Moderator Tools
// @namespace   WordPress_moderator_tools
// @description Adds keyboard shortcut navigation (and more) for WordPress forum moderators.
// @include     *://*wordpress.org/support/bb-admin/posts.php*
// @include     *://*wordpress.org/support/bb-admin/topics.php*
// @include     *://*wordpress.org/support/profile/*
// @include     *://*wordpress.org/support/forum/*
// @include     *://*wordpress.org/support/topic/*
// @include     *://*wordpress.org/support/edit.php?id=*
// @include     *://*wordpress.org/support/view/plugin-reviews/*
// @include     *://*wordpress.org/support/view/theme-reviews/*
// @include     *://*wordpress.org/tags/modlook
// @version     3.2
// @downloadURL https://github.com/keesiemeijer/WordPress-moderator-tools/raw/master/WordPress_Moderator_Tools_Chrome_min.user.js
// @updateURL https://github.com/keesiemeijer/WordPress-moderator-tools/raw/master/WordPress_Moderator_Tools_Chrome_min.user.js
// @grant       none
// ==/UserScript==

function moderator_tools_with_jquery(b){var a=document.createElement("script");a.type="text/javascript";a.textContent="("+b.toString()+")(jQuery)";document.body.appendChild(a)}moderator_tools_with_jquery(function(L){var W="hide";var g="#e3cebd";var K="#moderator_tools_menu{position:fixed;top:10px;left:65px;background:white;border:3px solid #333333; color:#333333; padding: 0 3em 0 10px;}#moderator_tools_menu a{text-decoration:none;border:none;}#moderator_tools_menu a:hover{color:#d54e21;}#wordpress-org #moderator_tools_menu{font-size:13px}#wordpress-org #moderator_tools_menu .wpmt_close_menu span{display:none; }.wpmt_stats{padding-bottom:1em;}.wpmt_stats span{display:inline-block;margin:5px 0;}.wpmt_shortcuts_help{margin-left:5px;} .wpmt_shortcut{background-color:#cae8f7;padding:1px 3px;display:inline-block;margin-bottom:4px;font-weight:bold}.wpmt_shortcuts_title{display:block;font-weight:bold;margin:1em 0}#wordpress-org .wpmt_shortcuts_title{display:inline}.wpmt_shortcuts_top{margin-bottom:1em}.wpmt_close_menu{position: absolute; right: 0; top: 5px;padding:0;margin:4px 1em 0 0; }.wpmt_close_menu a{font-size:1.8em;border:0;}.wpmt_is_admin .wpmt_close_menu a{font-size:1.5em;}.wpmt_menu_state{margin-right:40px}.wpmt_profile_edit{display:block;margin-top:5px}.wpmt_modlook{background-color:#efeef5;margin-left:.5em;padding:1px 2px;}.wpmt_ip-warning{color:red;display:block;} .reviewer .wpmt_ip-warning{display:inline-block;margin-right:1em;}",e="wpmt_current",ac="https://wordpress.org/support/bb-admin",E='<span class="wpmt_shortcuts_title">Shortcuts available for this page:</span>',b=L('<div id="moderator_tools_menu"></div>'),w=L('<span class="wpmt_close_menu"><a href="#" >&times;</a></span>'),I=L('<span class="wpmt_menu_state"></span>'),T=L('<p class="wpmt_shortcuts_top"></p>'),i={},D={},F=false,a=false,d=false,O=true,f,P,q,A,ab;var h={ANT:new RegExp('id="elf_not_trusted".+?checked="checked"',"gi"),EditPost:new RegExp(".+?/support/edit.php.+?","gi"),username:new RegExp('id="userlogin">(.+?)<',"gi")};var H={a:"%a% - <span class='wpmt_select'>select</span>/deselect all posts",d:"%d% - loop through Bulk Actions dropdown options",e1:"%e% - edit the user profile from the current post in a new tab.",e2:"%e% - refresh this profile page",e3:"%e% - open the edit profile page in a new tab",e4:"%e% - open the current post's user profile page in a new tab",h:"%h% - show/hide shortcuts",i:"%i% - edit all user profiles from <span class='wpmt_select'>selected posts</span> in new tabs.",shift_i:"%shift i% to edit non bozo user profiles only",m:"%m% - show/hide menu",n:"%n% - go to User Activity",r:"%r% - open the user's bb-admin posts page in a new tab",s:"%s% - <span class='wpmt_select'>select</span>/deselect current post",v:"%v% - view current post in a new tab",w:"%w% - remove website url (or add it back)",x:'%x% - select/deselect "Akismet Never Trust" checkbox',z:'%z% - select/deselect "This user is a bozo" checkbox',z_x:"%z% - go to the next normal profile post | %x% - go to the previous normal profile post",z_x1:"%z% - go to the next user with a duplicate IP | %x% - go to the previous user with a duplicate IP",shift_z_x:"%shift z% - go to the next bozo profile post | %shift x% - go to the previous bozo profile post",t_b:"%t% - go to the top of this page  | %b% - go to the bottom of this page",n_p:"%n% - go to the next post | %p% - go to the previous post",click_author:"%mouse click% - Click in the Author column to <span class='wpmt_select'>select</span>/deselect a post (also sets the post to current)",click_post:"%mouse click% - Click anywhere in a post to set it to current, for navigation with the shortcuts %n% and %p% (see above)"};function V(){if(s(L("#moderator_tools_menu"))||s(L("#moderator_tools_ed_uncap"))){return}var ad=true;if(s(L("#posts-list"))){a=true;d=true;Q("posts")}if(s(L("#topics-list"))){a=true;d=true;Q("topics")}if(!a){var ae=L(".mod-login");if(s(ae)){d=true;L("head").append('<style type="text/css">#headline .login{text-align:right;}</style>');ae.append(' | <a href="'+ac+'/posts.php?forum_id=0&post_status=2">Spam Queue</a> | <a href="https://wordpress.org/tags/modlook">Modlook</a>');if(s(L("#profile-form"))){M()}if(s(L(".edit-form"))){j();ad=false}if(s(L(".forumlist"))){X(".widefat")}if(s(L(".all-reviews"))){l();ad=false}}if(s(L("#user-replies"))||s(L("#user-threads"))){o()}if(s(L("#thread"))){v();ad=false}}else{b.addClass("wpmt_is_admin")}if(ad){aa();J();r()}B();u()}function Q(ae){var ag=(ae==="topics")?"topic":"post";D={bulk_actions:"",topics:ae==="topics"?true:false,column:".check-column > input",author:L("td.author"),toggle:L('<a href="#">shortcuts</a>'),help:L(' <span class="wpmt_shortcuts_help">(h) </span>'),stats:L('<span class="wpmt_stats"></span>')};D.bulk_actions_checkbox=L("thead tr "+D.column+",tfoot tr "+D.column);var ad="table.widefat tr.wpmt_current td{border:solid #9f9f9f;border-width:2px 0}table.widefat tr.wpmt_current td.check-column{border-left:2px solid #9f9f9f}table#posts-list tr.wpmt_current td.date,table#topics-list tr.wpmt_current td.freshness{border-right:2px solid #9f9f9f}{border-right:2px solid #9f9f9f}.wpmt_bozo_profile{display:block;margin-top:10px;color:white;text-align:center;background:red}.wpmt_profile_type{padding:4px 6px;border:1px solid red}.wpmt_profile_type.wpmt_green{border:1px solid green}.wpmt_selected,.wpmt_select{background-color: "+g+";}.wpmt_profile_type.wpmt_selected{padding: 5px 7px;border:none;}";L("head").append('<style type="text/css">'+K+ad+"</style>");var af=k([H.m,H.t_b,H.n_p,H.h,H.d,H.a,H.s,H.v,H.e1,H.i]);if(!D.topics){af=af.replace(/<br\/>$/g,"");af+=" | "+k([H.shift_i,H.z_x,H.shift_z_x])}af+=k([H.click_author,H.click_post]);af=(D.topics)?af.split("post").join(ag):af;D.shortcuts=L('<p style="display: none;">'+E+af+"</p>");b.append(D.stats,D.help,D.toggle,w,D.shortcuts);L("body").append(b);L("#bbUserInfo > p").prepend(I);c();q="tr."+e;A="tr:first";ab=L("#"+ae+"-list tbody tr");f=L("#bbHead");P=ab.last();Z();m()}function M(){var ae=L("#user_url");D={website:ae,site_url:ae.val(),bozo:L("input#is_bozo"),askimet:L("#elf_not_trusted")};L("head").append('<style type="text/css">'+K+"</style>");var ad=H.n_p.split("post").join("section");var af=k([H.m,H.t_b,ad,H.e2,H.r,H.w,H.z,H.x]);T.append(E,w);af="<p>"+af+"</p>";b.append(T,af);L("body").append(b);I.insertBefore(L("#profile-form")).wrap("<p></p>");c();q="#profile-form h3."+e;A="h3.wpmt_section:first";ab=L("#profile-form h3");ab.addClass("wpmt_section");L("h3:contains('Mailing Lists')").removeClass("wpmt_section");L("h3:contains('Administration')").addClass("wpmt_admin_section");L("label[for='user_url']").append(z(" %(w)%"));L("label[for='is_bozo']").append(z(" %(z)%"));L("label[for='elf_not_trusted']").append(z(" %(x)%"));f=L("#wporg-header");P=L("#wporg-footer");S();t()}function o(){L("head").append('<style type="text/css">'+K+"</style>");var ae=k([H.m,H.t_b,H.n]);if(d){ae+=k([H.e3,H.r])}T.append(E,w);ae="<p>"+ae+"</p>";b.append(T,ae);L("body").append(b);var ad=L(".topicnav").first().find("p");ad.css("margin","0 0 .5em");I.insertAfter(ad).wrap("<p></p>");c();L.each(["#user-replies","#user-threads"],function(af,ag){X(ag)});q="#useractivity."+e;A=0;ab=L("#useractivity");f=L("#wporg-header");P=L("#wporg-footer");if(d){S()}}function v(){D={tags:L("#yourtaglist"),author:".threadauthor > p > strong"};var ad=".wpmt_current .authortitle a, .reviewer-name {background-color: #efeef5;padding: 3px 6px;margin: 3px 0;display: inline-block;}.wpmt_ip-warning{color:red;}";L("head").append('<style type="text/css">'+K+ad+"</style>");var af="<p>"+k([H.m,H.t_b,H.n_p,H.z_x1,H.e4,H.click_post])+"</p>";T.append(E,w);b.append(T,af);L("body").append(b);var ae=L(".topicnav").first().find(".bbcrumb");ae.css("margin","0 0 .5em");I.insertAfter(ae).wrap("<p></p>");c();q="li."+e;A="li:first";ab=L(".postitem");f=L("#wporg-header");P=ab.last();if(s(ab)>1){U()}R();J();r();C();G();if(ab.length===1){ab.first().trigger("click.wpmt")}}function l(){ab=L(".review");if(s(ab)<1){return}D={author:".reviewer-name"};var ad="<p>"+k([H.m,H.t_b,H.n_p,H.z_x1])+"</p>";T.append(E,w);b.append(T,ad);L("body").append(b);L(".all-reviews").prepend(I);I.wrap("<p></p>");c();q="div."+e;f=L("#wporg-header");P=L("#wporg-footer");U();y();R();J();r();K+=".wpmt_current a.reviewer-name {background-color: #efeef5;padding: 3px 6px;margin: 3px 0;display: inline-block;}";L("head").append('<style type="text/css">'+K+"</style>")}function t(){L("html").bind("keydown.wpmt",function(ah){var ad=n(ah);var ag;if((F!==false)||(1!==ad)){return}if((87===ah.keyCode)&&(s(D.website)===1)){L(q).removeClass(e);ag=ab.first();ag.addClass(e);Y(ag);if(D.site_url){if(""===D.website.val()){D.website.val(D.site_url)}else{D.website.val("")}clearTimeout(af);D.website.parents("tr").css("background-color","#FFFFCC");var af=setTimeout(function(){D.website.parents("tr").css("background-color","#FFFFFF")},300)}}if(ah.keyCode===90||ah.keyCode===88){var ae=(ah.keyCode===90)?D.bozo:D.askimet;if(ae){L(q).removeClass(e);ag=L("h3.wpmt_admin_section").addClass(e);if(s(ag)===1){Y(L(ag));if(ae.attr("checked")){ae.removeAttr("checked")}else{ae.click()}clearTimeout(ai);ae.parents("tr").css("background-color","#FFFFCC");var ai=setTimeout(function(){ae.parents("tr").css("background-color","#FFFFFF")},300)}}}})}function G(){ab.bind("click.wpmt",function(ad){if(ad.target.nodeName!=="A"){x();L(this).addClass(e)}});L("html").bind("keydown.wpmt",function(ag){if(F!==false){return}var ae=n(ag);var af=L(q);if(s(af)){var ad=L(af).find(".authortitle a");if(s(ad)){if((ag.keyCode===69)&&(ae=1)){N(ad.attr("href"))}}}});L('[class^="delete:yourtaglist:"]').click(function(af){if(O){af.preventDefault();var ae=L(this).closest("li"),ad=L(this).attr("href");L.ajax({url:ad,async:true,dataType:"html",success:function(ag){ae.fadeOut()}})}})}function m(){L("html").bind("keydown.wpmt",function(al){if(F!==false){return}var ak=n(al);var am,ae;if((al.keyCode===83)&&(ak===1)){am=L(q);if(s(am)===1){Y(am);var af=am.find(D.column);af.attr("checked",!af.attr("checked"));Z()}}if((al.keyCode===86)&&(ak===1)){am=L(q);if(s(am)){var ap=D.topics?am.find(".row-title > a:first"):am.find(".row-actions > a:first");if(s(ap)){if(D.topics){ae=ap.attr("href")}else{ae=(ap.text()==="View")?ap.attr("href"):0}if(ae.length){N(ae)}}}}if((al.keyCode===68)&&(ak===1)){L(".bulk-form select[name=action] > option:selected").removeAttr("selected").next("option").attr("selected","selected")}if((al.keyCode===65)&&(ak===1)){D.bulk_actions=(D.bulk_actions_checkbox.attr("checked"))?"off":"on";p()}if((al.keyCode===72)&&(ak===1)){D.shortcuts.toggle();am=L(q);if(s(am)){Y(am)}}if(i.hasOwnProperty(73)){var ai,ao=[],an=false;if(!D.topics&&(i.hasOwnProperty(16)&&ak===2)){an=true;ai=L(".wpmt_normal_post").find(".post_selected")}else{if(ak===1){an=true;ai=L(".post_selected")}}if(an&&s(ai)){ai.each(function(){ae=L(this).children().first("a").attr("href");if(ao.indexOf(ae)===-1){ao.push(ae);N(ae+"/edit")}})}}if((al.keyCode===69)&&(ak===1)){am=L(q);if(s(am)===1){ae=am.find(".wpmt_profile_edit > a").attr("href");if(ae.length){N(ae)}}}if(!D.topics&&(ab.length>=1)){if(i.hasOwnProperty(90)||i.hasOwnProperty(88)){var ah=(i.hasOwnProperty(16)&&(ak===2))?"bozo":"normal";var aq=i.hasOwnProperty(90)?"z":"x",ag=L(".wpmt_"+ah+"_post");if(s(ag)){if(!s(L(q))){if(aq==="z"||((ag.length===1)&&aq==="x")){am=ag.first();am.addClass(e);Y(am)}}else{if(ag.length===1){var aj=ag.first();x();aj.addClass(e);Y(aj)}else{var ad;am=L(q);if(aq==="z"){ad=am.nextAll(".wpmt_"+ah+"_post:first")}if(aq==="x"){ad=am.prevAll(".wpmt_"+ah+"_post:first")}if(s(ad)){x();ad.addClass(e);Y(ad)}}}}}}});if(O){L(".post-delete-link, .post-spam-link").click(function(af){af.preventDefault();var ae=L(this).closest("tr"),ad=L(this).attr("href");L.ajax({url:ad,async:true,dataType:"html",success:function(ag){ae.fadeOut()}})})}D.bulk_actions_checkbox.bind("click.wpmt",function(){D.bulk_actions=(L(this).attr("checked"))?"on":"off";p()});ab.bind("click.wpmt",function(ad){if(ad.target.nodeName!=="A"){L("tbody tr").removeClass(e);L(this).addClass(e)}});L("tbody > tr > "+D.column).bind("click.wpmt",function(ad){Z()});D.author.bind("click.wpmt",function(ad){if(ad.target.nodeName!=="A"){Z(L(this).parent().attr("id"))}});D.toggle.bind("click.wpmt",function(ad){ad.preventDefault();D.shortcuts.toggle()});w.bind("click.wpmt",function(ad){ad.preventDefault();D.shortcuts.hide()})}function S(){var ad=L("#profile-menu");var ai;var af;var ah;if(s(ad)){ai=ad.find("a").filter(function(aj){return L(this).text()==="Edit"})}else{return}if(s(ai)){ai.text("Edit (e)");af=ai.attr("href");var ae=L("#userlogin");if(s(ae)){ah=ac+"/posts.php?forum_id=0&post_author="+ae.text();var ag=L('<li><a href="'+ah+'">bb-admin (r)</a></li>');ai.parent().after(ag)}}if(!(af.length||ah.length)){return}L("html").bind("keydown.wpmt",function(ak){var aj=n(ak);if((F!==false)||(aj!==1)){return}if((ak.keyCode===69)&&(af.length)){if(s(L("#profile-form"))){location.reload(true)}else{N(af)}}if((ak.keyCode===82)&&(ah.length)){N(ah)}})}function aa(){var ad;L("html").bind("keydown.wpmt",function(ag){if(F!==false||(typeof(ab)==="undefined")){return}var af=n(ag);if(!(ag.keyCode===78||ag.keyCode===80)||(af!==1)){return}var ae=ag.keyCode===78?"n":"p";if(!s(L(q))){if(ae==="n"){ad=ab.first();Y(ad);ad.addClass(e)}}else{ad=L(q);if(ae==="n"){if(s(ad.nextAll(A))){ad.removeClass(e).nextAll(A).addClass(e);Y(L(q))}else{Y(L(q))}}if(ae==="p"){if(s(ad.prevAll(A))){ad.removeClass(e).prevAll(A).addClass(e);Y(L(q))}else{ad.removeClass(e);if(s(f)&&A){Y(f)}}}}})}function R(){var ad;L("html").bind("keydown.wpmt",function(aj){if(F!==false||(typeof(ab)==="undefined")){return}var ag=n(aj);var ae=0;L.each({90:"z",88:"x",78:"n",80:"p"},function(al,am){if(aj.keyCode===parseInt(al)){ae=am}});if(!(ae&&(ag===1))){return}var ak=s(L(q));if(!ak&&((ae==="n")||(ae==="p"))){ai=ab.first();Y(ai);ai.addClass(e)}else{var ai=false,af=false,ah=false;ab.each(function(al){var an=false,am=false;if(!L(this).hasClass(e)){if(L(this).has(".wpmt_ip-warning").length){af=al}ah=al}if(L(this).hasClass(e)){ai=al;if(ae==="x"&&(af!==false)){an=af}if(ae==="p"&&(ah!==false)){an=ah}if(an!==false){ab.eq(ai).removeClass(e);ab.eq(an).addClass(e);Y(ab.eq(an));return false}}if(((ai!==false)&&(ai!==al))||!ak){if((ae==="z")&&L(this).has(".wpmt_ip-warning").length){am=al}if(ae==="n"){am=al}if(am!==false){ab.eq(ai).removeClass(e);ab.eq(am).addClass(e);Y(ab.eq(am));return false}}})}})}function J(){L("html").bind("keydown.wpmt",function(ae){if(F!==false){return}var ad=n(ae);if(s(f)&&(ae.keyCode===84)&&(ad===1)){Y(f);if(typeof(ab)!=="undefined"){x()}}if(s(P)&&(ae.keyCode===66)&&(ad===1)){Y(P);if(typeof(ab)!=="undefined"){x();ab.last().addClass(e)}}})}function r(){w.bind("click.wpmt",function(ae){ae.preventDefault();b.toggle();W=(b.is(":visible"))?"show":"hide";c();var ad=L(q);if(s(ad)){Y(ad)}});L("html").bind("keydown.wpmt",function(ae){if(F!==false){return}var ad=n(ae);if((ae.keyCode===77)&&(ad===1)){w.trigger("click.wpmt")}})}function p(){D.author.each(function(){var ad=L(this).parent().find(D.column);if(D.bulk_actions==="on"){ad.attr("checked",true)}else{ad.attr("checked",false)}});Z();D.bulk_actions=false}function Z(ai){D.stats.empty();var ah=0;D.author.each(function(){var ao=L(this).parent().children(".check-column").css("background-color"),al=L.trim(L(this).children().first("a").text()),am=L(this).parent().find(D.column);L(this).css("background",ao);if(!s(L(this).children(".wpmt_profile_edit"))){var ak=L("img",L(this).children().first("a")),aj='<br/><span class="wpmt_profile_edit"><a href="'+L(this).children().first("a").attr("href")+'/edit">Edit Profile</a></span>';if(al.indexOf("(BOZO)")>=0){al=L.trim(al.replace("(BOZO)",""));L(this).children().first("a").text(" "+al);if(ak){L(this).children().first("a").prepend(ak)}if(O){var an=L(this).children().first("a");L.ajax({url:an.attr("href")+"/edit",async:true,dataType:"html",success:function(ap){if(-1!=ap.search(h.ANT)){an.append('<span class="wpmt_bozo_profile" >BOZO (ANT)</span>');an.parent().addClass("wpmt_bozo_post")}else{an.append('<span class="wpmt_bozo_profile" >BOZO</span>');an.parent().addClass("wpmt_bozo_post")}}})}else{L(this).append('<span class="wpmt_bozo_profile" >BOZO</span>');L(this).parent().addClass("wpmt_bozo_post")}++ah}else{L(this).parent().addClass("wpmt_normal_post")}L(this).children().first("a").after(aj)}else{if(s(L(this).children("span.wpmt_bozo_profile"))){++ah}}if(am.attr("checked")){L(this).attr("style","background: "+g+";");L(this).addClass("post_selected")}else{L(this).css("background",ao);L(this).removeClass("post_selected")}if((typeof(ai)!=="undefined")&&(ai===L(this).parent().attr("id"))){if(am.attr("checked")){L(this).css("background",ao);am.attr("checked",false);L(this).removeClass("post_selected")}else{L(this).attr("style","background: "+g+";");am.attr("checked",true);L(this).addClass("post_selected")}}});var ae=L("tbody > tr").length,ag=L("tbody > tr > "+D.column+":checked").length;if(ag<ae){L(D.bulk_actions_checkbox).attr("checked",false)}if(ag===ae){L(D.bulk_actions_checkbox).attr("checked",true)}var ad="";var af=(D.topics)?"topic":"post";ad+="Current Page: "+ae+" "+af+((ae===1)?"":"s");if(!D.topics){ad+=' &#10022; <span class="wpmt_profile_type">';ad+=(ah>0)?ah+" bozo"+((ah===1)?"":"s"):"0 bozos";ad+="</span>";ad+=' &#10022; <span class="wpmt_profile_type wpmt_green">';ad+=(ae-ah>0)?(ae-ah)+" normal profile"+(((ae-ah)===1)?"":"s"):"no normal profiles";ad+="</span>"}ad+=' | <span class="wpmt_profile_type wpmt_selected">';ad+=(ag>0)?ag+" "+af+((ag===1)?"":"s")+" selected":"No "+af+"s selected";ad+="</span> | ";D.stats.append(ad)}function U(){L(".wpmt_ip-warning").remove();var af=ab;var ae={};var ag={};var ad={};af=af.filter(function(){var ah=L(this).find(D.author).text();var ai=L(this).find(".post-ip-link").text();if(!(ah.length&&ai.length)){return false}if(ae[ah+ai]){return false}else{ae[ah+ai]=true;return true}});L.each(af,function(ah,ai){var aj=L(this).find(".post-ip-link").text();if(aj.length){if(ag[aj]){ad[aj]=true}else{ag[aj]=true}}});if(L.isEmptyObject(ad)){return}ab.each(function(){var ai=L(this).find(".post-ip-link");if(s(ai)===1){var ah=ai.text();if(ad[ah]){ai.before(L('<span class="wpmt_ip-warning">(DUPLICATE IP)</span>'))}}})}function C(){L("#yourtaglist").find("a").each(function(){if(L(this).text()==="modlook"){var ae=L(this).parents("li");if(s(ae)){parent_id=ae.attr("id").split("_");if(parent_id[1].length){if(O){var ad=parent_id[1];L.ajax({url:"https://wordpress.org/support/profile/"+parent_id[1],async:true,dataType:"html",success:function(ag){var af=h.username.exec(ag);if(af.length>=2){ad=af[1]}ae.append(L('<a class="wpmt_modlook" href="https://wordpress.org/support/profile/'+parent_id[1]+'" title="modlook tagged by user '+parent_id[1]+'">'+ad+"</a>"))}})}else{ae.append(L('<a class="wpmt_modlook" href="https://wordpress.org/support/profile/'+parent_id[1]+'" title="modlook tagged by user '+parent_id[1]+'">'+parent_id[1]+"</a>"))}}}}})}function j(){var ah=0,ad=0,af=0;var ag=L("#ed_toolbar");if(s(ag)){var ae=L('<input id="moderator_tools_ed_uncap" class="moderator_tools_ed_button" type="button" value="l-case" accesskey="d">');ag.append(ae);L("#post_content").add(L("#topic")).select(function(ai){ah=ai.target.selectionStart;ad=ai.target.selectionEnd;af=L(this)});ae.bind("click.wpmt",function(al){al.preventDefault();if(af){var ak=af.val().substring(ah,ad).toLowerCase();var ai=af.val().substring(0,ah)+ak+af.val().substring(ad);af.val(ai);af.focus();var aj=af.get(0);aj.selectionStart=ad;aj.selectionEnd=ad}ah=ad=af=0})}}function X(ad){var ae=L(ad).find("a");if(!s(L(ae))){return}L(ae).attr("href",function(){var ag=this.search;var af=this.protocol+"//"+this.host+this.pathname;var ah=false;if(ag){var ai=/view=all/g;if(!ai.test(ag)){ah=af+ag+"&view=all"}}else{ah=af+"?view=all"}if(ah){return ah+this.hash}return this})}function B(){el=L("form");if(s(el)){el.focusin(function(){F=true}).focusout(function(){F=false})}}function u(){L(document).bind("keyup.wpmt",function(ad){if(i.hasOwnProperty(ad.which)){delete i[ad.which]}})}function n(ad){i[ad.which]=true;return Object.keys(i).length}function Y(ae){var af=ae.offset().top;var ad=65;if(b.is(":visible")){ad=b.height();ad+=30}else{if((L(ae).height()+ad)>L(window).height()){ad=5}}af=af-ad;L("html, body").animate({scrollTop:af},{duration:150})}function c(){if("hide"===W){b.hide();I.text("type m to display the menu")}else{if("show"===W){I.text("type m to hide the menu")}else{W="hide";b.hide();I.text("type m to display the menu")}}}function x(){if(s(ab)){ab.removeClass(e)}}function N(ad){i={};setTimeout(function(){window.open(ad,"_blank")},200)}function k(ad){if(!s(ad)){return""}var ae="";L.each(ad,function(af,ag){ae+=z(ag)+"<br/>"});return ae}function z(ad){return ad.replace(/\%(.*?)\%/g,'<span class="wpmt_shortcut">$1</span>')}function s(ad){if(typeof(ad)!=="undefined"){return ad.length}return 0}function y(){var af=L("#pages").first(),ad=L(af).find("a").not(".next"),aj=ad.last(),ah=1,ag=window.location.href,ae=L('<div class="all-reviews_container" id="all-reviews_container"/>'),ak=L(".all-reviews").append(ae);if(af.children().first().hasClass("current")){var ai=L('<button aria-controls="all-reviews_container"  aria-expanded="false" class="button reviews-toggle-all">All reviews</button>');ak.prepend(ai);ai.click(function(){if(ai.hasClass("reviews-toggle-all--visible")){ae.hide();x();ab=L(".all-reviews > .review");U();ai.text("All reviews").removeClass("reviews-toggle-all--visible").attr("aria-expanded",false)}else{if(ai.hasClass("reviews-toggle-all--toggled")){ae.show();ai.text("Fewer reviews").addClass("reviews-toggle-all--visible").attr("aria-expanded",true)}else{var al=1;ai.text("Fewer reviews").addClass("reviews-toggle-all--toggled reviews-toggle-all--visible").attr("aria-expanded",true);for(ah;ah<aj.text();ah++){L.get(ag+"/page/"+(ah+1),function(an){var am=L(an).find(".review");ae.append(am);if(al===parseInt(aj.text())-1){ab=L(".review");U()}al++})}}}});K+='.reviews-toggle-all {margin-bottom: 2em;padding-right: 2em;position: relative;}.reviews-toggle-all:after {content: "+";position: absolute;right: 10px;top: 0;font-family: seriffont-size: 16px;}.reviews-toggle-all--visible:after {content: "-";}'}}V()});