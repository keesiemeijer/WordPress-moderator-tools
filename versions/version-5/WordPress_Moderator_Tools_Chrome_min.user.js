// ==UserScript==
// @name        WordPress Moderator Tools
// @namespace   WordPress_moderator_tools
// @description Adds keyboard shortcut navigation (and more) for WordPress forum moderators.
// @include     *://*wordpress.org/support/bb-admin/posts.php*
// @include     *://*wordpress.org/support/bb-admin/topics.php*
// @include     *://*wordpress.org/support/profile/*
// @include     *://*wordpress.org/support/forum/*
// @include     *://*wordpress.org/support/topic/*
// @include     *://*wordpress.org/support/edit.php?id=*
// @include     *://*wordpress.org/support/view/plugin-reviews/*
// @include     *://*wordpress.org/support/view/theme-reviews/*
// @include     *://*wordpress.org/tags/modlook
// @version     5.0.0
// @downloadURL https://github.com/keesiemeijer/WordPress-moderator-tools/raw/master/WordPress_Moderator_Tools_Chrome_min.user.js
// @updateURL https://github.com/keesiemeijer/WordPress-moderator-tools/raw/master/WordPress_Moderator_Tools_Chrome_min.user.js
// @grant       none
// ==/UserScript==

function moderator_tools_with_jquery(b){var a=document.createElement("script");a.type="text/javascript";a.textContent="("+b.toString()+")(jQuery)";document.body.appendChild(a)}moderator_tools_with_jquery(function(O){var ac="hide";var g="#e3cebd";var N="#moderator_tools_menu{position:fixed;top:10px;left:65px;background:white;border:3px solid #333333; color:#333333; padding: 0 3em 0 10px;}#moderator_tools_menu a{text-decoration:none;border:none;}#moderator_tools_menu a:hover{color:#d54e21;}#wordpress-org #moderator_tools_menu{font-size:13px}#wordpress-org #moderator_tools_menu .wpmt_close_menu span{display:none; }.wpmt_stats{padding-bottom:1em;}.wpmt_stats span{display:inline-block;margin:5px 0;}.wpmt_shortcuts_help{margin-left:5px;} .wpmt_shortcut{background-color:#cae8f7;padding:1px 3px;display:inline-block;margin-bottom:4px;font-weight:bold}.wpmt_shortcuts_title{display:block;font-weight:bold;margin:1em 0}#wordpress-org .wpmt_shortcuts_title{display:inline}.wpmt_shortcuts_top{margin-bottom:1em}.wpmt_close_menu{position: absolute; right: 0; top: 5px;padding:0;margin:4px 1em 0 0; }.wpmt_close_menu a{font-size:1.8em;border:0;}.wpmt_is_admin .wpmt_close_menu a{font-size:1.5em;}.wpmt_menu_state{margin-right:40px}.wpmt_profile_edit{display:block;margin-top:5px}.wpmt_modlook{background-color:#efeef5;margin-left:.5em;padding:1px 2px;}.wpmt_ip-warning{color:red;display:block;} .reviewer .wpmt_ip-warning{display:inline-block;margin-right:1em;}.wpmt_screen_reader_text{clip: rect(1px, 1px, 1px, 1px);position: absolute !important;height: 1px;width: 1px;overflow: hidden;}.wpmt_error{color:red;}",e="wpmt_current",ai="https://wordpress.org/support/bb-admin",H='<span class="wpmt_shortcuts_title">Shortcuts available for this page:</span>',b=O('<div id="moderator_tools_menu"></div>'),z=O('<span class="wpmt_close_menu"><a href="#" >&times;</a></span>'),L=O('<span class="wpmt_menu_state"></span>'),Y=O('<p class="wpmt_shortcuts_top"></p>'),i={},G={},I=false,a=false,d=false,R=true,f,S,s,D,ah;var h={ANT:new RegExp('id="elf_not_trusted".+?checked="checked"',"gi"),EditPost:new RegExp(".+?/support/edit.php.+?","gi"),username:new RegExp('id="userlogin">(.+?)<',"gi")};var K={a:"%a% - <span class='wpmt_select'>select</span>/deselect all posts",d:"%d% - loop through Bulk Actions dropdown options",e1:"%e% - edit the user profile from the current post in a new tab.",e2:"%e% - refresh this profile page",e3:"%e% - open the edit profile page in a new tab",e4:"%e% - open the current post's user profile page in a new tab",h:"%h% - show/hide shortcuts",i:"%i% - edit all user profiles from <span class='wpmt_select'>selected posts</span> in new tabs.",shift_i:"%shift i% to edit non bozo user profiles only",m:"%m% - show/hide menu",n:"%n% - go to User Activity",r:"%r% - open the user's bb-admin posts page in a new tab",s:"%s% - <span class='wpmt_select'>select</span>/deselect current post",v:"%v% - view current post in a new tab",w:"%w% - remove website url (or add it back)",x:'%x% - select/deselect "Akismet Never Trust" checkbox',z:'%z% - select/deselect "This user is a bozo" checkbox',shift_b:"%shift b% - block the current user",z_x:"%z% - go to the next normal profile post | %x% - go to the previous normal profile post",z_x1:"%z% - go to the next user with a duplicate IP | %x% - go to the previous user with a duplicate IP",shift_z_x:"%shift z% - go to the next bozo or blocked profile post | %shift x% - go to the previous bozo or blocked profile post",t_b:"%t% - go to the top of this page  | %b% - go to the bottom of this page",n_p:"%n% - go to the next post | %p% - go to the previous post",click_author:"%mouse click% - Click in the Author column to <span class='wpmt_select'>select</span>/deselect a post (also sets the post to current)",click_post:"%mouse click% - Click anywhere in a post to set it to current, for navigation with the shortcuts %n% and %p% (see above)"};function aa(){if(v(O("#moderator_tools_menu"))||v(O("#moderator_tools_ed_uncap"))){return}var aj=true;if(v(O("#posts-list"))){a=true;d=true;T("posts")}if(v(O("#topics-list"))){a=true;d=true;T("topics")}if(!a){var ak=O(".mod-login");if(v(ak)){d=true;O("head").append('<style type="text/css">#headline .login{text-align:right;}</style>');ak.append(' | <a href="'+ai+'/posts.php?forum_id=0&post_status=2">Spam Queue</a> | <a href="https://wordpress.org/tags/modlook">Modlook</a>');if(v(O("#profile-form"))){P()}if(v(O(".edit-form"))){j();ab();aj=false}if(v(O(".forumlist"))){ad(".widefat")}if(v(O(".all-reviews"))){m();aj=false}}if(v(O("#user-replies"))||v(O("#user-threads"))){p()}if(v(O("#thread"))){y();aj=false}}else{b.addClass("wpmt_is_admin")}if(aj){ag();M();u()}E();x()}function T(ak){var an=(ak==="topics")?"topic":"post";G={bulk_actions:"",topics:ak==="topics"?true:false,column:".check-column > input",author:O("td.author"),toggle:O('<a href="#">shortcuts</a>'),help:O(' <span class="wpmt_shortcuts_help">(h) </span>'),stats:O('<span class="wpmt_stats"></span>')};G.bulk_actions_checkbox=O("thead tr "+G.column+",tfoot tr "+G.column);var aj="table.widefat tr.wpmt_current td{border:solid #9f9f9f;border-width:2px 0}table.widefat tr.wpmt_current td.check-column{border-left:2px solid #9f9f9f}table#posts-list tr.wpmt_current td.date,table#topics-list tr.wpmt_current td.freshness{border-right:2px solid #9f9f9f}{border-right:2px solid #9f9f9f}.wpmt_bozo_profile{display:block;margin-top:10px;color:white;text-align:center;background:red}.wpmt_profile_type{padding:4px 6px;border:1px solid red}.wpmt_profile_type.wpmt_green{border:1px solid green}.wpmt_selected,.wpmt_select{background-color: "+g+";}.wpmt_profile_type.wpmt_selected{padding: 5px 7px;border:none;}";aj+='.mod-tools-ips-btn, .mod-tools-ips-wrapper{font-family: "Lucida Grande", Verdana, Arial, "Bitstream Vera Sans", sans-serif;} .mod-tools-ips-btn {border-radius:10px;padding:4px 9px 5px;background:url(images/white-grad.png) repeat-x #f2f2f2;border:1px solid #bbb;color:#464646;cursor:pointer;line-height:1.1em;font-size:.85em; margin: 1.2em 0 0 5em}.mod-tools-ips-wrapper{font-size: .85em; margin: 1em 0;} .mod-tools-ips-heading {font-weight: 700; margin-bottom: .8em} .mod-tools-results-list {padding-left: 5px; border-left: 2px solid gold;} .mod-tools-ips-button-pressed {border-color: gold;}';O("head").append('<style type="text/css">'+N+aj+"</style>");var am=k([K.m,K.t_b,K.n_p,K.h,K.d,K.a,K.s,K.v,K.e1,K.i]);if(!G.topics){am=am.replace(/<br\/>$/g,"");am+=" | "+k([K.shift_i,K.z_x,K.shift_z_x])}am+=k([K.click_author,K.click_post]);am=(G.topics)?am.split("post").join(an):am;G.shortcuts=O('<p style="display: none;">'+H+am+"</p>");b.append(G.stats,G.help,G.toggle,z,G.shortcuts);O("body").append(b);O("#bbUserInfo > p").prepend(L);c();s="tr."+e;D="tr:first";ah=O("#"+ak+"-list tbody tr");f=O("#bbHead");S=ah.last();af();n();var al=O(".post");q(al);if(t("post_author").length){W()}}function P(){var ak=O("input#user_url");G={website:ak,site_url:ak.val(),bozo:O("input#is_bozo"),askimet:O("input#elf_not_trusted"),trusted:O("input#elf_trusted"),location:O("input#from"),occupation:O("input#occ"),interest:O("input#interest"),user_type:O("select#admininfo_role"),};O("head").append('<style type="text/css">'+N+"</style>");var aj=K.n_p.split("post").join("section");var al=k([K.m,K.t_b,aj,K.e2,K.r,K.w,K.z,K.x,K.shift_b]);Y.append(H,z);al="<p>"+al+"</p>";b.append(Y,al);O("body").append(b);L.insertBefore(O("#profile-form")).wrap("<p></p>");c();s="#profile-form h3."+e;D="h3.wpmt_section:first";ah=O("#profile-form h3");ah.addClass("wpmt_section");O("h3:contains('Mailing Lists')").removeClass("wpmt_section");O("h3:contains('Administration')").addClass("wpmt_admin_section");O("label[for='user_url']").append(C(" %(w)%"));O("label[for='is_bozo']").append(C(" %(z)%"));O("label[for='elf_not_trusted']").append(C(" %(x)%"));f=O("#wporg-header");S=O("#wporg-footer");X();w()}function p(){O("head").append('<style type="text/css">'+N+"</style>");var ak=k([K.m,K.t_b,K.n]);if(d){ak+=k([K.e3,K.r])}Y.append(H,z);ak="<p>"+ak+"</p>";b.append(Y,ak);O("body").append(b);var aj=O(".topicnav").first().find("p");aj.css("margin","0 0 .5em");L.insertAfter(aj).wrap("<p></p>");c();O.each(["#user-replies","#user-threads"],function(al,am){ad(am)});s="#useractivity."+e;D=0;ah=O("#useractivity");f=O("#wporg-header");S=O("#wporg-footer");if(d){X();if(G.edit_href.length){O.get(G.edit_href,function(am){var an=O(am).find("#admininfo_role option:selected");var al=O("dl#userinfo");if(v(an)&&v(al)){al.append(O('<dt>User Type</dt><dd><span class="wpmt">'+an.text()+"</span></dd>"))}})}}}function y(){G={tags:O("#yourtaglist"),author:".threadauthor > p > strong",post_content:O("#post_content"),};var aj=".wpmt_current .authortitle a, .reviewer-name {background-color: #efeef5;padding: 3px 6px;margin: 3px 0;display: inline-block;}.wpmt_ip-warning{color:red;}.wpmt_ping_link{margin-left:1em;}";O("head").append('<style type="text/css">'+N+aj+"</style>");var am="<p>"+k([K.m,K.t_b,K.n_p,K.z_x1,K.e4,K.click_post])+"</p>";Y.append(H,z);b.append(Y,am);O("body").append(b);var al=O(".topicnav").first().find(".bbcrumb");al.css("margin","0 0 .5em");L.insertAfter(al).wrap("<p></p>");c();s="li."+e;D="li:first";ah=O(".postitem");f=O("#wporg-header");S=ah.last();if(v(ah)>1){Z()}U();M();u();F();if(v(G.post_content)){O(".threadauthor > p",ah).each(function(an){O(this).find(".authortitle").after('<a href="#post_content" class="wpmt_ping_link">@Ping</a>')})}J();if(ah.length===1){ah.first().trigger("click.wpmt")}if((O("#thread").length!==0)&&v(O(".mod-login"))){var ak=O(".threadpost .post");q(ak)}}function m(){ah=O(".review");if(v(ah)<1){return}G={author:".reviewer-name",target:O(".review-ratings .col-1")};var aj="<p>"+k([K.m,K.t_b,K.n_p,K.z_x1])+"</p>";Y.append(H,z);b.append(Y,aj);O("body").append(b);O(".all-reviews").prepend(L);L.wrap("<p></p>");c();s="div."+e;f=O("#wporg-header");S=O("#wporg-footer");Z();B();U();l();M();u();N+=".wpmt_current a.reviewer-name {background-color: #efeef5;padding: 3px 6px;margin: 3px 0;display: inline-block;}";O("head").append('<style type="text/css">'+N+"</style>")}function w(){O("html").bind("keydown.wpmt",function(ao){var ak=o(ao);var an;if(I!==false){return}if(i.hasOwnProperty(66)){if(i.hasOwnProperty(16)&&(ak===2)){var aj=confirm("You're about to block this user!\nThis will remove user fields: Website, Location, Occupation and Interests.\n\n 'Cancel' to stop, 'OK' to block this user.");if(aj==true){G.website.val("");G.location.val("");G.occupation.val("");G.interest.val("");G.user_type.val("blocked");G.bozo.removeAttr("checked");G.trusted.removeAttr("checked");if(!G.askimet.attr("checked")){G.askimet.click()}O("#profile-form").submit()}}}if(1!==ak){return}if((87===ao.keyCode)&&(v(G.website)===1)){O(s).removeClass(e);an=ah.first();an.addClass(e);ae(an);if(G.site_url){if(""===G.website.val()){G.website.val(G.site_url)}else{G.website.val("")}clearTimeout(am);G.website.parents("tr").css("background-color","#FFFFCC");var am=setTimeout(function(){G.website.parents("tr").css("background-color","#FFFFFF")},300)}}if(ao.keyCode===90||ao.keyCode===88){var al=(ao.keyCode===90)?G.bozo:G.askimet;if(al){O(s).removeClass(e);an=O("h3.wpmt_admin_section").addClass(e);if(v(an)===1){ae(O(an));if(al.attr("checked")){al.removeAttr("checked")}else{al.click()}clearTimeout(ap);al.parents("tr").css("background-color","#FFFFCC");var ap=setTimeout(function(){al.parents("tr").css("background-color","#FFFFFF")},300)}}}})}function J(){ah.bind("click.wpmt",function(aj){if(aj.target.nodeName!=="A"){A();O(this).addClass(e)}});O(".wpmt_ping_link").bind("click.wpmt_ping",function(am){am.preventDefault();var ak=O(this).parents(".threadauthor").find("strong").first().text();if(!v(G.post_content)||!ak.length){return}var aj=G.post_content;ak="@"+ak+"\n";var al=O.trim(aj.val());ak=al.length?"\n\n"+ak:ak;aj.val(al+ak);aj[0].focus();aj.scrollTop(aj[0].scrollHeight)});O("html").bind("keydown.wpmt",function(am){if(I!==false){return}var ak=o(am);var al=O(s);if(v(al)){var aj=O(al).find(".authortitle a");if(v(aj)){if((am.keyCode===69)&&(ak=1)){Q(aj.attr("href"))}}}});O('[class^="delete:yourtaglist:"]').click(function(al){if(R){al.preventDefault();var ak=O(this).closest("li"),aj=O(this).attr("href");O.ajax({url:aj,async:true,dataType:"html",success:function(am){ak.fadeOut()}})}})}function n(){O("html").bind("keydown.wpmt",function(ar){if(I!==false){return}var aq=o(ar);var at,ak;if((ar.keyCode===83)&&(aq===1)){at=O(s);if(v(at)===1){ae(at);var al=at.find(G.column);al.attr("checked",!al.attr("checked"));af()}}if((ar.keyCode===86)&&(aq===1)){at=O(s);if(v(at)){var aw=G.topics?at.find(".row-title > a:first"):at.find(".row-actions > a:first");if(v(aw)){if(G.topics){ak=aw.attr("href")}else{ak=(aw.text()==="View")?aw.attr("href"):0}if(ak.length){Q(ak)}}}}if((ar.keyCode===68)&&(aq===1)){O(".bulk-form select[name=action] > option:selected").removeAttr("selected").next("option").attr("selected","selected")}if((ar.keyCode===65)&&(aq===1)){G.bulk_actions=(G.bulk_actions_checkbox.attr("checked"))?"off":"on";r()}if((ar.keyCode===72)&&(aq===1)){G.shortcuts.toggle();at=O(s);if(v(at)){ae(at)}}if(i.hasOwnProperty(73)){var ao,av=[],au=false;if(!G.topics&&(i.hasOwnProperty(16)&&aq===2)){au=true;ao=O(".wpmt_normal_post").find(".post_selected")}else{if(aq===1){au=true;ao=O(".post_selected")}}if(au&&v(ao)){ao.each(function(){ak=O(this).children().first("a").attr("href");if(av.indexOf(ak)===-1){av.push(ak);Q(ak+"/edit")}})}}if((ar.keyCode===69)&&(aq===1)){at=O(s);if(v(at)===1){ak=at.find(".wpmt_profile_edit > a").attr("href");if(ak.length){Q(ak)}}}if(!G.topics&&(ah.length>=1)){if(i.hasOwnProperty(90)||i.hasOwnProperty(88)){var an=(i.hasOwnProperty(16)&&(aq===2))?"bozo":"normal";var ax=i.hasOwnProperty(90)?"z":"x",am=O(".wpmt_"+an+"_post");if(v(am)){if(!v(O(s))){if(ax==="z"||((am.length===1)&&ax==="x")){at=am.first();at.addClass(e);ae(at)}}else{if(am.length===1){var ap=am.first();A();ap.addClass(e);ae(ap)}else{var aj;at=O(s);if(ax==="z"){aj=at.nextAll(".wpmt_"+an+"_post:first")}if(ax==="x"){aj=at.prevAll(".wpmt_"+an+"_post:first")}if(v(aj)){A();aj.addClass(e);ae(aj)}}}}}}});if(R){O(".post-delete-link, .post-spam-link").click(function(al){al.preventDefault();var ak=O(this).closest("tr"),aj=O(this).attr("href");O.ajax({url:aj,async:true,dataType:"html",success:function(am){ak.fadeOut(300,function(){O(this).remove();af()})}})})}G.bulk_actions_checkbox.bind("click.wpmt",function(){G.bulk_actions=(O(this).attr("checked"))?"on":"off";r()});ah.bind("click.wpmt",function(aj){if(aj.target.nodeName!=="A"){O("tbody tr").removeClass(e);O(this).addClass(e)}});O("tbody > tr > "+G.column).bind("click.wpmt",function(aj){af()});G.author.bind("click.wpmt",function(aj){if(aj.target.nodeName!=="A"){af(O(this).parent().attr("id"))}});G.toggle.bind("click.wpmt",function(aj){aj.preventDefault();G.shortcuts.toggle()});z.bind("click.wpmt",function(aj){aj.preventDefault();G.shortcuts.hide()})}function X(){var aj=O("#profile-menu");var ao;var an;var al;if(v(aj)){ao=aj.find("a").filter(function(ap){return O(this).text()==="Edit"})}else{return}if(v(ao)){ao.text("Edit (e)");al=ao.attr("href");var ak=O("#userlogin");if(v(ak)){an=ai+"/posts.php?forum_id=0&post_author="+ak.text();var am=O('<li><a href="'+an+'">bb-admin (r)</a></li>');ao.parent().after(am)}}if(!(al.length||an.length)){return}G.edit_href=al;O("html").bind("keydown.wpmt",function(aq){var ap=o(aq);if((I!==false)||(ap!==1)){return}if((aq.keyCode===69)&&(al.length)){if(v(O("#profile-form"))){location.reload(true)}else{Q(al)}}if((aq.keyCode===82)&&(an.length)){Q(an)}})}function ag(){var aj;O("html").bind("keydown.wpmt",function(am){if(I!==false||(typeof(ah)==="undefined")){return}var al=o(am);if(!(am.keyCode===78||am.keyCode===80)||(al!==1)){return}var ak=am.keyCode===78?"n":"p";if(!v(O(s))){if(ak==="n"){aj=ah.first();ae(aj);aj.addClass(e)}}else{aj=O(s);if(ak==="n"){if(v(aj.nextAll(D))){aj.removeClass(e).nextAll(D).addClass(e);ae(O(s))}else{ae(O(s))}}if(ak==="p"){if(v(aj.prevAll(D))){aj.removeClass(e).prevAll(D).addClass(e);ae(O(s))}else{aj.removeClass(e);if(v(f)&&D){ae(f)}}}}})}function U(){var aj;O("html").bind("keydown.wpmt",function(ap){if(I!==false||(typeof(ah)==="undefined")){return}var am=o(ap);var ak=0;O.each({90:"z",88:"x",78:"n",80:"p"},function(ar,at){if(ap.keyCode===parseInt(ar)){ak=at}});if(!(ak&&(am===1))){return}var aq=v(O(s));if(!aq&&((ak==="n")||(ak==="p"))){ao=ah.first();ae(ao);ao.addClass(e)}else{var ao=false,al=false,an=false;ah.each(function(ar){var au=false,at=false;if(!O(this).hasClass(e)){if(O(this).has(".wpmt_ip-warning").length){al=ar}an=ar}if(O(this).hasClass(e)){ao=ar;if(ak==="x"&&(al!==false)){au=al}if(ak==="p"&&(an!==false)){au=an}if(au!==false){ah.eq(ao).removeClass(e);ah.eq(au).addClass(e);ae(ah.eq(au));return false}}if(((ao!==false)&&(ao!==ar))||!aq){if((ak==="z")&&O(this).has(".wpmt_ip-warning").length){at=ar}if(ak==="n"){at=ar}if(at!==false){ah.eq(ao).removeClass(e);ah.eq(at).addClass(e);ae(ah.eq(at));return false}}})}})}function M(){O("html").bind("keydown.wpmt",function(ak){if(I!==false){return}var aj=o(ak);if(v(f)&&(ak.keyCode===84)&&(aj===1)){ae(f);if(typeof(ah)!=="undefined"){A()}}if(v(S)&&(ak.keyCode===66)&&(aj===1)){ae(S);if(typeof(ah)!=="undefined"){A();ah.last().addClass(e)}}})}function u(){z.bind("click.wpmt",function(ak){ak.preventDefault();b.toggle();ac=(b.is(":visible"))?"show":"hide";c();var aj=O(s);if(v(aj)){ae(aj)}});O("html").bind("keydown.wpmt",function(ak){if(I!==false){return}var aj=o(ak);if((ak.keyCode===77)&&(aj===1)){z.trigger("click.wpmt")}})}function r(){G.author.each(function(){var aj=O(this).parent().find(G.column);if(G.bulk_actions==="on"){aj.attr("checked",true)}else{aj.attr("checked",false)}});af();G.bulk_actions=false}function af(ao){G.stats.empty();var an=0;G.author.each(function(){var ax=O(this).parent().children(".check-column").css("background-color"),ar=O.trim(O(this).children().first("a").text()),au=O(this).parent().find(G.column);O(this).css("background",ax);if(!v(O(this).children(".wpmt_profile_edit"))){var aq=O("img",O(this).children().first("a")),ap='<br/><span class="wpmt_profile_edit"><a href="'+O(this).children().first("a").attr("href")+'/edit">Edit Profile</a></span>';var at=(ar.indexOf("(BOZO)")!==-1)?"BOZO":"";if(ar.indexOf("(BLOCKED)")!==-1){at+=(at.length)?" - BLOCKED":"BLOCKED"}if(at.length){ar=O.trim(ar.replace("(BOZO)",""));ar=O.trim(ar.replace("(BLOCKED)",""));O(this).children().first("a").text(" "+ar);if(aq){O(this).children().first("a").prepend(aq)}if(R){var aw=O(this).children().first("a");O.ajax({url:aw.attr("href")+"/edit",async:true,dataType:"html",success:function(ay){if(-1!=ay.search(h.ANT)){aw.append('<span class="wpmt_bozo_profile" >'+at+" - ANT</span>");aw.parents("tr").addClass("wpmt_bozo_post")}else{aw.append('<span class="wpmt_bozo_profile" >'+at+"</span>");aw.parents("tr").addClass("wpmt_bozo_post")}},error:function(){aw.append('<span class="wpmt_bozo_profile" >'+at+"</span>");aw.parents("tr").addClass("wpmt_bozo_post")}})}else{O(this).append('<span class="wpmt_bozo_profile" >'+at+"</span>");O(this).parents("tr").addClass("wpmt_bozo_post")}if(at.indexOf("BOZO")!==-1){++an}}else{O(this).parent().addClass("wpmt_normal_post")}O(this).children().first("a").after(ap)}else{var av=O(this).find("span.wpmt_bozo_profile");if(v(av)&&(av.text().indexOf("BOZO")!==-1)){++an}}if(au.attr("checked")){O(this).attr("style","background: "+g+";");O(this).addClass("post_selected")}else{O(this).css("background",ax);O(this).removeClass("post_selected")}if((typeof(ao)!=="undefined")&&(ao===O(this).parent().attr("id"))){if(au.attr("checked")){O(this).css("background",ax);au.attr("checked",false);O(this).removeClass("post_selected")}else{O(this).attr("style","background: "+g+";");au.attr("checked",true);O(this).addClass("post_selected")}}});var ak=O("tbody > tr").length,am=O("tbody > tr > "+G.column+":checked").length;if(am<ak){O(G.bulk_actions_checkbox).attr("checked",false)}if(am===ak){O(G.bulk_actions_checkbox).attr("checked",true)}var aj="";var al=(G.topics)?"topic":"post";aj+="Current Page: "+ak+" "+al+((ak===1)?"":"s");if(!G.topics){aj+=' &#10022; <span class="wpmt_profile_type">';aj+=(an>0)?an+" bozo"+((an===1)?"":"s"):"0 bozos";aj+="</span>"}aj+=' | <span class="wpmt_profile_type wpmt_selected">';aj+=(am>0)?am+" "+al+((am===1)?"":"s")+" selected":"No "+al+"s selected";aj+="</span> | ";G.stats.append(aj)}function Z(){O(".wpmt_ip-warning").remove();var al=ah;var ak={};var am={};var aj={};al=al.filter(function(){var an=O(this).find(G.author).text();var ao=O(this).find(".post-ip-link").text();if(!(an.length&&ao.length)){return false}if(ak[an+ao]){return false}else{ak[an+ao]=true;return true}});O.each(al,function(an,ao){var ap=O(this).find(".post-ip-link").text();if(ap.length){if(am[ap]){aj[ap]=true}else{am[ap]=true}}});if(O.isEmptyObject(aj)){return}ah.each(function(){var ao=O(this).find(".post-ip-link");if(v(ao)===1){var an=ao.text();if(aj[an]){ao.before(O('<span class="wpmt_ip-warning">(DUPLICATE IP)</span>'))}}})}function F(){O("#yourtaglist").find("a").each(function(){if(O(this).text()!=="modlook"){return true}var ak=O(this).parents("li");if(!v(ak)){return true}parent_id=ak.attr("id").split("_");if(parent_id[1].length){if(R){var aj=parent_id[1];O.ajax({url:"https://wordpress.org/support/profile/"+parent_id[1],async:true,dataType:"html",success:function(am){var al=h.username.exec(am);if(al.length>=2){aj=al[1]}ak.append(O('<a class="wpmt_modlook" href="https://wordpress.org/support/profile/'+parent_id[1]+'" title="modlook tagged by user '+parent_id[1]+'">'+aj+"</a>"))}})}else{ak.append(O('<a class="wpmt_modlook" href="https://wordpress.org/support/profile/'+parent_id[1]+'" title="modlook tagged by user '+parent_id[1]+'">'+parent_id[1]+"</a>"))}}})}function j(){var an=0,aj=0,al=0;var am=O("#ed_toolbar");if(v(am)){var ak=O('<input id="moderator_tools_ed_uncap" class="moderator_tools_ed_button" type="button" value="l-case" accesskey="d">');am.append(ak);O("#post_content").add(O("#topic")).select(function(ao){an=ao.target.selectionStart;aj=ao.target.selectionEnd;al=O(this)});ak.bind("click.wpmt",function(ar){ar.preventDefault();if(al){var aq=al.val().substring(an,aj).toLowerCase();var ao=al.val().substring(0,an)+aq+al.val().substring(aj);al.val(ao);al.focus();var ap=al.get(0);ap.selectionStart=aj;ap.selectionEnd=aj}an=aj=al=0})}}function ad(aj){var ak=O(aj).find("a");if(!v(O(ak))){return}O(ak).attr("href",function(){var am=this.search;var al=this.protocol+"//"+this.host+this.pathname;var an=false;if(am){var ao=/view=all/g;if(!ao.test(am)){an=al+am+"&view=all"}}else{an=al+"?view=all"}if(an){return an+this.hash}return this})}function E(){el=O("form");if(v(el)){el.focusin(function(){I=true}).focusout(function(){I=false})}}function x(){O(document).bind("keyup.wpmt",function(aj){if(i.hasOwnProperty(aj.which)){delete i[aj.which]}})}function o(aj){i[aj.which]=true;return Object.keys(i).length}function ae(ak){var al=ak.offset().top;var aj=65;if(b.is(":visible")){aj=b.height();aj+=30}else{if((O(ak).height()+aj)>O(window).height()){aj=5}}al=al-aj;O("html, body").animate({scrollTop:al},{duration:150})}function c(){if("hide"===ac){b.hide();L.text("type m to display the menu")}else{if("show"===ac){L.text("type m to hide the menu")}else{ac="hide";b.hide();L.text("type m to display the menu")}}}function A(){if(v(ah)){ah.removeClass(e)}}function Q(aj){i={};setTimeout(function(){window.open(aj,"_blank")},200)}function k(aj){if(!v(aj)){return""}var ak="";O.each(aj,function(al,am){ak+=C(am)+"<br/>"});return ak}function C(aj){return aj.replace(/\%(.*?)\%/g,'<span class="wpmt_shortcut">$1</span>')}function V(al){var aj="<em>[Link redacted]</em>",ak={link:/<a.*?<\/a>/gi,http:/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi,www:/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi};return al.replace(ak.link,aj).replace(ak.http,aj).replace(ak.www,aj)}function t(aj){aj=aj.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var al=new RegExp("[\\?&]"+aj+"=([^&#]*)"),ak=al.exec(location.search);return ak===null?"":decodeURIComponent(ak[1].replace(/\+/g," "))}function v(aj){if(typeof(aj)!=="undefined"){return aj.length}return 0}function B(){var ar=O("#pages").first(),an=O(ar).find("a").not(".next"),aq=an.last(),ao=1,ak=window.location.href.split(/[?#]/)[0],am=t("filter"),al=O('<div class="all-reviews_container" id="all-reviews_container"/>'),aj=O(".all-reviews").append(al);if(ar.children().first().hasClass("current")){var ap=O('<button aria-controls="all-reviews_container"  aria-expanded="false" class="button reviews-toggle-all">All reviews</button>');aj.prepend(ap);ap.click(function(){if(ap.hasClass("reviews-toggle-all--visible")){al.hide();A();ah=O(".all-reviews > .review");Z();ap.text("All reviews").removeClass("reviews-toggle-all--visible").attr("aria-expanded",false)}else{if(ap.hasClass("reviews-toggle-all--toggled")){al.show();A();Z();ap.text("Fewer reviews").addClass("reviews-toggle-all--visible").attr("aria-expanded",true)}else{var at=1;ap.text("Fewer reviews").addClass("reviews-toggle-all--toggled reviews-toggle-all--visible").attr("aria-expanded",true);for(ao;ao<aq.text();ao++){var au="";if(am.length){au="?filter="+am}O.get(ak+"/page/"+(ao+1)+au,function(aw){var av=O(aw).find(".review");al.append(av);if(at===parseInt(aq.text())-1){ah=O(".review");Z()}at++})}}}});N+='.reviews-toggle-all {margin-bottom: 2em;padding-right: 2em;position: relative;}.reviews-toggle-all:after {content: "+";position: absolute;right: 10px;top: 0;font-family: seriffont-size: 16px;}.reviews-toggle-all--visible:after {content: "-";}'}}function ab(){var ak=O('<input class="ed_button" type="button" value="strip links" />'),al=O("#ed_toolbar"),aj=O("#post_content");if(!v(al)||!v(content)){return}al.append(ak);ak.click(function(am){updatedContent=V(aj.val());aj.val(updatedContent)})}function q(aj){if(!v(aj)){return}var ak="border: 2px solid gold; display: inline-block; margin: 5px; padding: 5px;";aj.each(function(){var an=O(this);var am=an.find("a").filter(function(ap){var aq=O.trim(O(this).text());if(aq==""){return true}else{if(aq.length<3){return true}}return false});if(!v(am)){return true}var al=O('<div><span class="wpmt_screen_reader_text">Hidden links, or links with less than 3 characters found in post content</span></div>');am.each(function(){var aq=O(this);var ap=a?"font-size:1.4em;":"";aq.text(aq[0].outerHTML);var ar=O('<pre style="'+ak+ap+'">'+aq.html()+"</pre>");al.append(ar);aq.hide()});if(a){var ao=O(".row-actions",an).parent();if(v(ao)){ao.before(al)}else{an.append(al)}}else{an.append(al)}})}function l(){var aj=O("<ol />"),al=G.target,ak=O('<form class="mod-tools-check-ips postform" />'),am=O('<div class="mod-tools-match-summary" />');if(!v(al)){return}al.removeClass("col-1").addClass("col-3");N+=".form-row { display: block; overflow: hidden; margin-bottom: 5px;} .mod-tools-check-ips label { font-weight: 700; } .mod-tools-ip-matched { border: 2px solid gold; padding: 0 5px; } .mod-tools-ip-matched-text { background: gold; padding: 2px; }";ak.append('<div class="form-row"><label for="mod-tools-check-ips">Match IPs</label></div>');ak.append('<div class="form-row"><input id="mod-tools-check-ips" placeholder="IPs space separated" type="text" /></div>');ak.append('<div class="form-row"><button class="button">Match</button></div>');al.append(ak);am.append(ak);al.append(am);ak.submit(function(aq){aq.preventDefault();var an=O(this).find("#mod-tools-check-ips").val(),ar=an.split(" "),ap=O(".post-ip-link"),ao=true;aj.remove();aj=O("<ol />");O(".mod-tools-ip-matched").removeClass("mod-tools-ip-matched");ap.each(function(av,au){var at=O(au);if(O.inArray(at.text(),ar)!==-1){var aw="mod-tools-ip-match-"+av;aj.append('<li><a href="#'+aw+'">'+at.text()+"</a></li>");at.addClass("mod-tools-ip-matched").attr("id",aw);ao=false}});if(ao){aj.append("<li>No matches</li>")}O(this).after(aj)})}function W(){var ao=O("div.submit"),am=O(".table-form"),al=O('<button class="button mod-tools-ips-btn">Extract IPs</button>'),an=O("<div />"),ak=O('<div class="mod-tools-ips-wrapper" />'),aj=O('<ul class="mod-tools-results-list" />');al.click(function(at){at.preventDefault();var ar=O(".post-ip-link"),ap=O('<h3 class="mod-tools-ips-heading">Extracted IPs</h3>'),aq=O(this);aj.remove();aj=O('<ul class="mod-tools-results-list" />');aq.removeClass("mod-tools-ips-button-pressed");ar.each(function(av,au){var ax=O(au),aw=ax.text();if(aj.find("[data-mod-tools-ip="+aw+"]").length===0){aj.append('<li data-mod-tools-ip="'+aw+'">'+aw+"</li>")}});if(ak.find(".mod-tools-ips-heading").length===0){ak.append(ap)}ak.append(aj);aq.addClass("mod-tools-ips-button-pressed")});am.before(ak);an.append(al);ao.after(an)}aa()});